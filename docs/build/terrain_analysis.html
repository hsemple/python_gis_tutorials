<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10. Terrain Analysis &mdash; Python GIS Tutorials 0.0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="9. Attribute and Spatial Queries" href="attribute_and_spatial_queries.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Python GIS Tutorials
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">1. Setting up Development Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_programs.html">2. Introduction to the Python Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="strings_lists_conditional.html">3. Strings and Lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditionals_and_looping.html">4. Conditional Statements and Looping</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">5. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_oriented_programming.html">6. Basic Concepts in Object Oriented Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="displaying_files.html">7. Reading and Displaying Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_projections.html">8. Map Projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="attribute_and_spatial_queries.html">9. Attribute and Spatial Queries</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. Terrain Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#displaying-dem">10.1. Displaying DEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-hillshades">10.2. Generating Hillshades</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slope-mapping">10.3. Slope Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aspect-mapping">10.4. Aspect Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#curvature-maps">10.5. Curvature Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-viewshed">10.6. Computing Viewshed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automating-terrain-analysis-workflows">10.7. Automating Terrain Analysis Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-gdal-command-line-utilities">10.8. Working with GDAL Command Line Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-gdal-commands-from-python">10.9. Running GDAL Commands from Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#batch-processing-using-gdal">10.10. Batch Processing Using GDAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automating-workflows">10.11. Automating Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">10.12. Exercises</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python GIS Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">10. </span>Terrain Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/terrain_analysis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="terrain-analysis">
<h1><span class="section-number">10. </span>Terrain Analysis<a class="headerlink" href="#terrain-analysis" title="Permalink to this heading"></a></h1>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>There are many python libraries that are available for terrain analysis.  Below, I use Arcpy, RichDEM, Rasterio, GDAL and pysheds for basic terrain analysis.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="displaying-dem">
<h2><span class="section-number">10.1. </span>Displaying DEM<a class="headerlink" href="#displaying-dem" title="Permalink to this heading"></a></h2>
<p>Terrain analysis starts with displaying digital elevation models.  We have touched on this topic before.  Below, a DEM of Stowe, VT is displayed with the RichDEM library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">richdem</span> <span class="k">as</span> <span class="nn">rd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">LoadGDAL</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/Users/.../elevation/w001001.adf&#39;</span><span class="p">)</span>

<span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">ignore_colours</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
</pre></div>
</div>
<img alt="DEM Loaded with RichDEM" src="_images/stowe_dem_richdem.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="generating-hillshades">
<h2><span class="section-number">10.2. </span>Generating Hillshades<a class="headerlink" href="#generating-hillshades" title="Permalink to this heading"></a></h2>
<p>Hillshades are used in terrain analysis to give elevation data a 3-dimensional appearance thereby making it easier to visualize variations in topography. Hillshades are also frequently used in GIS and Cartography as underlays to make other kinds of data more visually interesting. Google Maps use hillshades extensivelly to portray terrain features of the earth.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Generate Hillshade with ArcPy</strong></p>
<p>The two scripts below show how to generate hillshade maps using ArcPy within ArcMap or ArcGIS Pro.</p>
<ol class="arabic simple">
<li><p>Run this script from the ArcPy Window.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">arcpy.ia</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">out_hillshade_raster</span> <span class="o">=</span> <span class="n">Hillshade</span><span class="p">(</span><span class="s2">&quot;elevation.tif&quot;</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">0.3048</span><span class="p">)</span>
<span class="n">out_hillshade_raster</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/arcpyExamples/outputs/hillshade.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>This example calculates the hillshade using IDLE or any other IDE</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the system modules</span>
<span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy.ia</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Set the analysis environments</span>
<span class="n">arcpy</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/arcpyExamples/data&quot;</span>

<span class="c1"># Set the local variables</span>
<span class="n">in_dem</span> <span class="o">=</span> <span class="s2">&quot;elevation.tif&quot;</span>

<span class="c1"># Execute the Hillshade function</span>
<span class="n">out_hillshade_raster</span> <span class="o">=</span> <span class="n">Hillshade</span><span class="p">(</span><span class="n">in_dem</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">0.3048</span><span class="p">)</span>

<span class="c1"># Save the output</span>
<span class="n">out_hillshade_raster</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/arcpyExamples/outputs/hillshade.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Source</em>
<a class="reference external" href="https://pro.arcgis.com/en/pro-app/latest/arcpy/image-analyst/hillshade.htm">https://pro.arcgis.com/en/pro-app/latest/arcpy/image-analyst/hillshade.htm</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Generate Hillshade  using GDAL</strong></p>
<p>The code sample below shows the details of computing hillshade.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">gradient</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">arctan</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">arctan2</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sin</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">cos</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">uint8</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>



<span class="k">def</span> <span class="nf">hillshade</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">angle_altitude</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">arctan</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">azimuthrad</span> <span class="o">=</span> <span class="n">azimuth</span><span class="o">*</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">altituderad</span> <span class="o">=</span> <span class="n">angle_altitude</span><span class="o">*</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>


    <span class="n">shaded</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">altituderad</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
    <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">altituderad</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
    <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">azimuthrad</span> <span class="o">-</span> <span class="n">aspect</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">255</span><span class="o">*</span><span class="p">(</span><span class="n">shaded</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s1">&#39;/Users/semple/Desktop/topography/dem&#39;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

<span class="n">hs_array</span> <span class="o">=</span> <span class="n">hillshade</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="mi">315</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hs_array</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_earth&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Hillshade Calculated with GDAL" src="_images/stowe_gray_scale.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Generating Hillshade with Earthpy</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">earthpy</span> <span class="k">as</span> <span class="nn">et</span>
<span class="kn">import</span> <span class="nn">earthpy.spatial</span> <span class="k">as</span> <span class="nn">es</span>
<span class="kn">import</span> <span class="nn">earthpy.plot</span> <span class="k">as</span> <span class="nn">ep</span>


<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/Users/.../topography/dem&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">elev</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="n">hillshade</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">hillshade</span><span class="p">(</span><span class="n">elev</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span> <span class="n">altitude</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ep</span><span class="o">.</span><span class="n">plot_bands</span><span class="p">(</span>
    <span class="n">hillshade</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hillshade of Wayne County&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>For information in earthpy, see <a class="reference external" href="https://earthpy.readthedocs.io/en/latest/gallery_vignettes/plot_dem_hillshade.html#sphx-glr-gallery-vignettes-plot-dem-hillshade-py">https://earthpy.readthedocs.io/en/latest/gallery_vignettes/plot_dem_hillshade.html#sphx-glr-gallery-vignettes-plot-dem-hillshade-py</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Elevation Layer Draped on Hillshade using Earthpy and Matplotlib</strong></p>
<p>In this example, both the elevation layer and the hillshade layer are displayed in a single figure and ax object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">earthpy</span> <span class="k">as</span> <span class="nn">et</span>
<span class="kn">import</span> <span class="nn">earthpy.spatial</span> <span class="k">as</span> <span class="nn">es</span>
<span class="kn">import</span> <span class="nn">earthpy.plot</span> <span class="k">as</span> <span class="nn">ep</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>


<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/Users/.../elevation/w001001.adf&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="c1">#extent=[src.bounds[0], src.bounds[2], src.bounds[1], src.bounds[3]]</span>

<span class="n">hillshade</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">hillshade</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span> <span class="n">altitude</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ep</span><span class="o">.</span><span class="n">plot_bands</span><span class="p">(</span>
    <span class="n">elevation</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">src_array</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Digital Elevation Model (DEM)</span><span class="se">\n</span><span class="s2"> overlayed on top of a hillshade&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ep</span><span class="o">.</span><span class="n">plot_bands</span><span class="p">(</span><span class="n">hillshade</span><span class="p">,</span>
              <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span>
              <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
              <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
              <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Elevation Layer Draped on Hillshade" src="_images/stowe_elevation_hillshade.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="slope-mapping">
<h2><span class="section-number">10.3. </span>Slope Mapping<a class="headerlink" href="#slope-mapping" title="Permalink to this heading"></a></h2>
<p><strong>Generate Slope Map with Arcpy</strong></p>
<p>The two scripts below show how to calculate slope using ArcPy.</p>
<ol class="arabic simple">
<li><p>Run this script from the ArcPy Window.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy</span> <span class="kn">import</span> <span class="n">env</span>
<span class="kn">from</span> <span class="nn">arcpy.sa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/.../topography&quot;</span>
<span class="n">outSlope</span> <span class="o">=</span> <span class="n">Slope</span><span class="p">(</span><span class="s2">&quot;dem&quot;</span><span class="p">,</span> <span class="s2">&quot;DEGREE&quot;</span><span class="p">,</span> <span class="mf">0.3043</span><span class="p">)</span>  <span class="c1"># Slope Tool</span>
<span class="n">outSlope</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/Washtenaw/county/outslope01&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run this script using Idle in Python 2.7 on a machine that has ArcMap, or from Jupyter Notebook in ArcGIS Pro.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import system modules</span>
<span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy</span> <span class="kn">import</span> <span class="n">env</span>
<span class="kn">from</span> <span class="nn">arcpy.sa</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Set environment settings</span>
<span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/Washtenaw&quot;</span>

<span class="c1"># Set local variables</span>
<span class="n">inRaster</span> <span class="o">=</span> <span class="s2">&quot;C:/Washtenaw/county/washtenaw/topography/dem&quot;</span>
<span class="n">outMeasurement</span> <span class="o">=</span> <span class="s2">&quot;DEGREE&quot;</span>
<span class="n">zFactor</span> <span class="o">=</span> <span class="mf">0.3043</span>

<span class="c1"># Check out the ArcGIS Spatial Analyst extension license</span>
<span class="n">arcpy</span><span class="o">.</span><span class="n">CheckOutExtension</span><span class="p">(</span><span class="s2">&quot;Spatial&quot;</span><span class="p">)</span>

<span class="c1"># Execute Slope</span>
<span class="n">outSlope</span> <span class="o">=</span> <span class="n">Slope</span><span class="p">(</span><span class="n">inRaster</span><span class="p">,</span> <span class="n">outMeasurement</span><span class="p">,</span> <span class="n">zFactor</span><span class="p">)</span> <span class="c1"># Slope Tool</span>

<span class="c1"># Save the output</span>
<span class="n">outSlope</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/Washtenaw/county/outslope02&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Calculate Slope from a DEM using PyQGIS</strong></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/2g526ZoMu24" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe><div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Generate Slope using the RichDem Library</strong></p>
<p>First, install the RichDEM library. run the sample script below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">richdem</span> <span class="k">as</span> <span class="nn">rd</span>


<span class="c1">#Load Raster</span>
<span class="n">stowe_dem</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">LoadGDAL</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/Users/.../Stowe_DEM.tif&#39;</span><span class="p">)</span>

<span class="c1">#Perform Slope Calculation</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">TerrainAttribute</span><span class="p">(</span><span class="n">stowe_dem</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="s1">&#39;slope_riserun&#39;</span><span class="p">)</span>


<span class="c1">#Display slope map</span>
<span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
<img alt="Slope Map" src="_images/stowe_rich_dem_slope.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Generate Slope using GDAL</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">calculate_slope</span><span class="p">(</span><span class="n">DEM</span><span class="p">):</span>
      <span class="n">gdal</span><span class="o">.</span><span class="n">DEMProcessing</span><span class="p">(</span><span class="s1">&#39;slope.tif&#39;</span><span class="p">,</span> <span class="n">DEM</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">)</span>
     <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;slope.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
          <span class="n">slope</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">slope</span>


<span class="n">slope</span><span class="o">=</span><span class="n">calculate_slope</span><span class="p">(</span><span class="s2">&quot;/Users/student/Desktop/TestDEM.tif&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;copper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="aspect-mapping">
<h2><span class="section-number">10.4. </span>Aspect Mapping<a class="headerlink" href="#aspect-mapping" title="Permalink to this heading"></a></h2>
<p><strong>Calculate Aspect Using Arcpy</strong></p>
<p>The script below show how to generate an aspect map using ArcPy.</p>
<ol class="arabic simple">
<li><p>Calculate Aspect</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import system modules</span>
<span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy</span> <span class="kn">import</span> <span class="n">env</span>
<span class="kn">from</span> <span class="nn">arcpy.sa</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Set environment settings</span>
<span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/.../data&quot;</span>

<span class="c1"># Set local variables</span>
<span class="n">inRaster</span> <span class="o">=</span> <span class="s2">&quot;elevation&quot;</span>

<span class="c1"># Execute Aspect</span>
<span class="n">outAspect</span> <span class="o">=</span> <span class="n">Aspect</span><span class="p">(</span><span class="n">inRaster</span><span class="p">)</span>  <span class="c1"># Aspect tool</span>

<span class="c1"># Save the output</span>
<span class="n">outAspect</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/sapyexamples/output/outaspect02&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Generate Aspect Using the GDAL Library</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">calculate_aspect</span><span class="p">(</span><span class="n">DEM</span><span class="p">):</span>
       <span class="n">gdal</span><span class="o">.</span><span class="n">DEMProcessing</span><span class="p">(</span><span class="s1">&#39;aspect.tif&#39;</span><span class="p">,</span> <span class="n">DEM</span><span class="p">,</span> <span class="s1">&#39;aspect&#39;</span><span class="p">)</span>
              <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;aspect.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
              <span class="n">aspect</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
              <span class="k">return</span> <span class="n">aspect</span>

<span class="n">aspect</span><span class="o">=</span><span class="n">calculate_aspect</span><span class="p">(</span><span class="s2">&quot;/Users/.../TestDEM.tif&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">aspect</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;copper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>For more information, please see this website - <a class="reference external" href="https://richdem.readthedocs.io/en/latest/terrain_attributes.html">https://richdem.readthedocs.io/en/latest/terrain_attributes.html</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Generate Aspect Using the RichDEM Library</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">richdem</span> <span class="k">as</span> <span class="nn">rd</span>

<span class="n">dem</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">LoadGDAL</span><span class="p">(</span><span class="s1">&#39;/Users/.../elevation&#39;</span><span class="p">)</span>

<span class="n">aspect</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">TerrainAttribute</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="s1">&#39;aspect&#39;</span><span class="p">)</span>
<span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">aspect</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Aspect Map" src="_images/rich_dem_aspect.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="curvature-maps">
<h2><span class="section-number">10.5. </span>Curvature Maps<a class="headerlink" href="#curvature-maps" title="Permalink to this heading"></a></h2>
<p><strong>Generate Curvature Maps Using Arcpy</strong></p>
<p>The two scripts below show how to calculate curvature using ArcPy.</p>
<ol class="arabic simple">
<li><p>Curvature Example 1. Use in ArcGIS Python Window</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">arcpy.ia</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">out_curvature_raster</span> <span class="o">=</span> <span class="n">Curvature</span><span class="p">(</span><span class="s2">&quot;curvature_input.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">out_curvature_raster</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/.../curvature.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Curvature Example 2</p></li>
</ol>
<p>This example calculates the curvature of a given slope. Use in Idle or Python Notebook</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import system modules</span>
<span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy.ia</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Set the analysis environments</span>
<span class="n">arcpy</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/arcpyExamples/data&quot;</span>

<span class="c1"># Set the local variables</span>
<span class="n">in_raster</span> <span class="o">=</span> <span class="s2">&quot;curvature_input.tif&quot;</span>

<span class="c1"># Execute Curvature function</span>
<span class="n">out_curvature_raster</span> <span class="o">=</span> <span class="n">Curvature</span><span class="p">(</span><span class="n">in_raster</span><span class="p">,</span> <span class="s2">&quot;planform&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Save the output</span>
<span class="n">out_curvature_raster</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/arcpyExamples/outputs/cur_planform.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Click on this link for more code samples - <a class="reference external" href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst">https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="computing-viewshed">
<h2><span class="section-number">10.6. </span>Computing Viewshed<a class="headerlink" href="#computing-viewshed" title="Permalink to this heading"></a></h2>
<p><strong>Viewshed Using Arcpy</strong></p>
<p>This sample script comes from <a class="reference external" href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/3d-analyst/viewshed.htm">ESRI</a>. It calculates surface locations that are visible to a set of observers defined in a shapefile. The script requires the 3D Analyst Extension</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy</span> <span class="kn">import</span> <span class="n">env</span>

<span class="c1"># Set environment settings</span>
<span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/data&quot;</span>

<span class="c1"># Set local variables</span>
<span class="n">inRaster</span> <span class="o">=</span> <span class="s2">&quot;elevation&quot;</span>
<span class="n">inObserverFeatures</span> <span class="o">=</span> <span class="s2">&quot;observers.shp&quot;</span>
<span class="n">outViewshed</span> <span class="o">=</span> <span class="s2">&quot;C:/output/outvwshd02&quot;</span>
<span class="n">zFactor</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">useEarthCurvature</span> <span class="o">=</span> <span class="s2">&quot;CURVED_EARTH&quot;</span>
<span class="n">refractivityCoefficient</span> <span class="o">=</span> <span class="mf">0.15</span>

<span class="c1"># Execute Viewshed</span>
<span class="n">arcpy</span><span class="o">.</span><span class="n">ddd</span><span class="o">.</span><span class="n">Viewshed</span><span class="p">(</span><span class="n">inRaster</span><span class="p">,</span> <span class="n">inObserverFeatures</span><span class="p">,</span> <span class="n">outViewshed</span><span class="p">,</span> <span class="n">zFactor</span><span class="p">,</span>
   <span class="n">useEarthCurvature</span><span class="p">,</span> <span class="n">refractivityCoefficient</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="automating-terrain-analysis-workflows">
<h2><span class="section-number">10.7. </span>Automating Terrain Analysis Workflows<a class="headerlink" href="#automating-terrain-analysis-workflows" title="Permalink to this heading"></a></h2>
<p>Python scripts are useful for automating workflows that involve the use of multiple tools either parallel to each other or sequentially.  For example, if your terrain analysis involves producing both a slope map and an aspect map from the same digital elevation model, then these two computations can be integrated into a single script as shown in the example below.  On other occasions, the output of one processing operation becomes the input for another processing operation. These sequential operations are evident in the watershed delineation scripts that are presented below.</p>
<p><strong>a. Calculate Slope and Aspect Using a Single Script</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Import system modules</span>
<span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy</span> <span class="kn">import</span> <span class="n">env</span>
<span class="kn">from</span> <span class="nn">arcpy.sa</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">try</span><span class="p">:</span>
        <span class="c1"># Set environment settings</span>
        <span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/workspace&quot;</span>
        <span class="c1"># Set local variables</span>
        <span class="n">inRaster</span> <span class="o">=</span> <span class="s2">&quot;dem&quot;</span>
        <span class="n">outMeasurement</span> <span class="o">=</span> <span class="s2">&quot;DEGREE&quot;</span>
        <span class="n">zFactor</span> <span class="o">=</span> <span class="mf">0.3043</span>

        <span class="c1"># Check out the ArcGIS Spatial Analyst extension license</span>
        <span class="n">arcpy</span><span class="o">.</span><span class="n">CheckOutExtension</span><span class="p">(</span><span class="s2">&quot;Spatial&quot;</span><span class="p">)</span>

        <span class="c1"># Execute Slope</span>
        <span class="n">outSlope</span> <span class="o">=</span> <span class="n">Slope</span><span class="p">(</span><span class="n">inRaster</span><span class="p">,</span> <span class="n">outMeasurement</span><span class="p">,</span> <span class="n">zFactor</span><span class="p">)</span>

        <span class="c1"># Save the output</span>
        <span class="n">outSlope</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/workspace/outslope02&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;Slope successfully calculated&quot;</span>

        <span class="c1"># Execute Aspect</span>
        <span class="n">outAspect</span> <span class="o">=</span> <span class="n">Aspect</span><span class="p">(</span><span class="n">inRaster</span><span class="p">)</span>
        <span class="n">outAspect</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;C:/workspace/outaspect02&quot;</span><span class="p">)</span>

     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
         <span class="nb">print</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Automating Watershed Delineation Using PySheds</strong></p>
<p>In this script, the output of one processing becomes the output of the next process.</p>
<p><strong>Watershed Delineation with pysheds</strong></p>
<p>I came across a library called pysheds that can be used for watershed delineation. Tested sample code is presented below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysheds.grid</span> <span class="kn">import</span> <span class="n">Grid</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_raster</span><span class="p">(</span><span class="s1">&#39;/Users/.../elevation.tiff&#39;</span><span class="p">)</span>
<span class="n">dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">read_raster</span><span class="p">(</span><span class="s1">&#39;/Users/.../elevation.tiff&#39;</span><span class="p">)</span>


<span class="c1"># Fill Sinks</span>
<span class="c1"># ----------------------</span>
<span class="c1"># Fill pits in DEM</span>
<span class="n">pit_filled_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fill_pits</span><span class="p">(</span><span class="n">dem</span><span class="p">)</span>

<span class="c1"># Fill depressions in DEM</span>
<span class="n">flooded_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fill_depressions</span><span class="p">(</span><span class="n">pit_filled_dem</span><span class="p">)</span>

<span class="c1"># Resolve flats in DEM</span>
<span class="n">inflated_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">resolve_flats</span><span class="p">(</span><span class="n">flooded_dem</span><span class="p">)</span>


<span class="c1"># Determine D8 flow directions from DEM</span>
<span class="c1"># ----------------------</span>
<span class="c1"># Specify directional mapping</span>
<span class="n">dirmap</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>

<span class="c1"># Compute flow directions</span>
<span class="c1"># -------------------------------------</span>
<span class="n">fdir</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">flowdir</span><span class="p">(</span><span class="n">inflated_dem</span><span class="p">,</span> <span class="n">dirmap</span><span class="o">=</span><span class="n">dirmap</span><span class="p">)</span>


<span class="c1"># Calculate flow accumulation</span>
<span class="c1"># --------------------------</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">accumulation</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span> <span class="n">dirmap</span><span class="o">=</span><span class="n">dirmap</span><span class="p">)</span>


<span class="c1"># Delineate a catchment</span>
<span class="c1"># ---------------------</span>
<span class="c1"># Specify pour point</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">97.294</span><span class="p">,</span> <span class="mf">32.737</span>

<span class="c1"># Snap pour point to high accumulation cell</span>
<span class="n">x_snap</span><span class="p">,</span> <span class="n">y_snap</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">snap_to_mask</span><span class="p">(</span><span class="n">acc</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="c1"># Delineate the catchment</span>
<span class="n">catch</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">catchment</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_snap</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_snap</span><span class="p">,</span> <span class="n">fdir</span><span class="o">=</span><span class="n">fdir</span><span class="p">,</span> <span class="n">dirmap</span><span class="o">=</span><span class="n">dirmap</span><span class="p">,</span>
                       <span class="n">xytype</span><span class="o">=</span><span class="s1">&#39;coordinate&#39;</span><span class="p">)</span>

<span class="c1"># Crop and plot the catchment</span>
<span class="c1"># ---------------------------</span>
<span class="c1"># Clip the bounding box to the catchment</span>
<span class="n">grid</span><span class="o">.</span><span class="n">clip_to</span><span class="p">(</span><span class="n">catch</span><span class="p">)</span>
<span class="n">clipped_catch</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">catch</span><span class="p">)</span>


<span class="c1"># Extract river network</span>
<span class="c1"># ---------------------</span>
<span class="n">branches</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">extract_river_network</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">,</span> <span class="n">dirmap</span><span class="o">=</span><span class="n">dirmap</span><span class="p">)</span>


<span class="c1"># Calculate distance to outlet from each cell</span>
<span class="c1"># -------------------------------------------</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">distance_to_outlet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_snap</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_snap</span><span class="p">,</span> <span class="n">fdir</span><span class="o">=</span><span class="n">fdir</span><span class="p">,</span> <span class="n">dirmap</span><span class="o">=</span><span class="n">dirmap</span><span class="p">,</span>
                               <span class="n">xytype</span><span class="o">=</span><span class="s1">&#39;coordinate&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Source: <a class="reference external" href="http://mattbartos.com/pysheds/">http://mattbartos.com/pysheds/</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Automating Watershed Delineation Using ArcPy</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import system modules</span>
<span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">from</span> <span class="nn">arcpy</span> <span class="kn">import</span> <span class="n">env</span>
<span class="kn">from</span> <span class="nn">arcpy.sa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Set environment settings</span>
    <span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/Hugh/Desktop/watershed&quot;</span>
    <span class="n">env</span><span class="o">.</span><span class="n">overwriteOutput</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Check out ArcGIS Spatial Analyst extension</span>
    <span class="n">arcpy</span><span class="o">.</span><span class="n">CheckOutExtension</span><span class="p">(</span><span class="s2">&quot;Spatial&quot;</span><span class="p">)</span>

    <span class="c1"># Fill sink</span>
    <span class="n">outFill</span> <span class="o">=</span> <span class="n">Fill</span><span class="p">(</span><span class="s2">&quot;elevation&quot;</span><span class="p">)</span>
    <span class="n">outFill</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;fill01&quot;</span><span class="p">)</span>

    <span class="c1">#Flow Direction</span>
    <span class="n">outFlowDirection</span> <span class="o">=</span> <span class="n">FlowDirection</span><span class="p">(</span><span class="s2">&quot;fill01&quot;</span><span class="p">,</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">)</span>
    <span class="n">outFlowDirection</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;flowdir&quot;</span><span class="p">)</span>

    <span class="c1"># Flow Accumulation</span>
    <span class="n">outFlowAccumulation</span> <span class="o">=</span> <span class="n">FlowAccumulation</span><span class="p">(</span><span class="s2">&quot;flowdir&quot;</span><span class="p">)</span>
    <span class="n">outFlowAccumulation</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;flowAccum&quot;</span><span class="p">)</span>

    <span class="c1"># Define stream length</span>
    <span class="n">streams</span> <span class="o">=</span> <span class="n">Con</span><span class="p">(</span><span class="n">Raster</span><span class="p">(</span><span class="s2">&quot;flowAccum&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">streams</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">)</span>

    <span class="c1"># Stream Link</span>
    <span class="n">outStreamLink</span> <span class="o">=</span> <span class="n">StreamLink</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="s2">&quot;flowdir&quot;</span><span class="p">)</span>
    <span class="n">outStreamLink</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;outStreamLink&quot;</span><span class="p">)</span>

    <span class="c1"># Stream to Feature</span>
    <span class="n">outStreamFeat</span> <span class="o">=</span> <span class="n">StreamToFeature</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="s2">&quot;flowdir&quot;</span><span class="p">,</span> <span class="s2">&quot;outstrm01.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;NO_SIMPLIFY&quot;</span><span class="p">)</span>

    <span class="c1">#Delineate Watershed</span>
    <span class="n">PourPoint</span> <span class="o">=</span> <span class="s2">&quot;PourPoint.shp&quot;</span>
    <span class="n">outWatershed</span> <span class="o">=</span> <span class="n">Watershed</span><span class="p">(</span><span class="s2">&quot;flowdir&quot;</span><span class="p">,</span> <span class="n">PourPoint</span><span class="p">,</span> <span class="s2">&quot;Id&quot;</span><span class="p">)</span>
    <span class="n">outWatershed</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;watershed&quot;</span><span class="p">)</span><span class="c1">#Delineate Watershed</span>

    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Watershed successfully delineated&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="working-with-gdal-command-line-utilities">
<h2><span class="section-number">10.8. </span>Working with GDAL Command Line Utilities<a class="headerlink" href="#working-with-gdal-command-line-utilities" title="Permalink to this heading"></a></h2>
<p>GDAL (Geospatial Data Abstraction Library) is perhaps the most established library for reading and processing raster and vector geographical data. It is used by many GIS including ArcGIS and QGIS.  GDAL is written in the C++ programming language, but bindings are available that allow it to called from other languages.</p>
<p>GDAL also has some special programs called <a class="reference external" href="https://gdal.org/programs/index.html">Utilities</a>, which are useful for performing many popular GIS tasks.  These utilities can be called from the command line assuming that proper path is set. They can also be from within Python.  In this section, we will look at how to call GDAL Utilities from the command line.  In the next section, we will look at calling GDAL from within Python.</p>
<p><strong>Getting Information about a Raster</strong></p>
<p>Let’s try the gdalifo command which can be executed from the command prompt. Gdalifo returns a lengthy list of details about the raster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; $ gdalinfo /Users/.../WhiteadderDEM.tif

Driver: AIG/Arc/Info Binary Grid
Files: /Users/.../Desktop/Stowe_Dataset/elevation
Size is 775, 756
Coordinate System is:
PROJCRS[&quot;unnamed&quot;,
    BASEGEOGCRS[&quot;NAD83&quot;,
        DATUM[&quot;North American Datum 1983&quot;,
            ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,
                LENGTHUNIT[&quot;metre&quot;,1]]],
        PRIMEM[&quot;Greenwich&quot;,0,
            ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
        ID[&quot;EPSG&quot;,4269]],
    CONVERSION[&quot;unnamed&quot;,
        METHOD[&quot;Transverse Mercator&quot;,
            ID[&quot;EPSG&quot;,9807]],
        PARAMETER[&quot;Latitude of natural origin&quot;,42.5,
            ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
            ID[&quot;EPSG&quot;,8801]],
        PARAMETER[&quot;Longitude of natural origin&quot;,-72.5,
            ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
            ID[&quot;EPSG&quot;,8802]],
        PARAMETER[&quot;Scale factor at natural origin&quot;,0.999964286,
            SCALEUNIT[&quot;unity&quot;,1],
            ID[&quot;EPSG&quot;,8805]],
        PARAMETER[&quot;False easting&quot;,500000,
            LENGTHUNIT[&quot;METERS&quot;,1],
            ID[&quot;EPSG&quot;,8806]],
        PARAMETER[&quot;False northing&quot;,0,
            LENGTHUNIT[&quot;METERS&quot;,1],
            ID[&quot;EPSG&quot;,8807]]],
    CS[Cartesian,2],
        AXIS[&quot;easting&quot;,east,
            ORDER[1],
            LENGTHUNIT[&quot;METERS&quot;,1]],
        AXIS[&quot;northing&quot;,north,
            ORDER[2],
            LENGTHUNIT[&quot;METERS&quot;,1]]]
Data axis to CRS axis mapping: 1,2
Origin = (470957.412858718482312,231421.559170683787670)
Pixel Size = (30.680581002795002,-30.680581002795002)
Metadata:
  DataType=Generic
Corner Coordinates:
Upper Left  (  470957.413,  231421.559) ( 72d51&#39;56.55&quot;W, 44d34&#39;56.75&quot;N)
Lower Left  (  470957.413,  208227.040) ( 72d51&#39;51.86&quot;W, 44d22&#39;25.30&quot;N)
Upper Right (  494734.863,  231421.559) ( 72d33&#39;58.68&quot;W, 44d34&#39;58.78&quot;N)
Lower Right (  494734.863,  208227.040) ( 72d33&#39;57.83&quot;W, 44d22&#39;27.33&quot;N)
Center      (  482846.138,  219824.300) ( 72d42&#39;56.23&quot;W, 44d28&#39;42.39&quot;N)
Band 1 Block=256x16 Type=Float32, ColorInterp=Undefined
  Description = elevation
  Min=133.493 Max=1335.372
  Minimum=134.525, Maximum=1333.913, Mean=476.449, StdDev=214.550
  NoData Value=-3.4028234663852886e+38
  Overviews: 388x378, 194x189
  Metadata:
    RepresentationType=ATHEMATIC
    STATISTICS_APPROXIMATE=YES
    STATISTICS_MAXIMUM=1333.9129638672
    STATISTICS_MEAN=476.44892214671
    STATISTICS_MINIMUM=134.52473449707
    STATISTICS_STDDEV=214.55017815777
    STATISTICS_VALID_PERCENT=98.84
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Converting Between Raster Formats</strong></p>
<p>We can convert between raster file formats using the gdal_translate tool. Gdal_translate recognises many file formats. To set the file format, use the ‘-of’ flag. An example of the syntax is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; $ gdal_translate -of ENVI  /Users/student/Downloads/WhiteadderDEM.tif  /Users/hsemple/Downloads/WhiteadderDEM.bil
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Clipping Rasters using GDAL</strong></p>
<p>Clipping rasters can be done quite easily using gdal. You can enter the bounding coordinates of the clipping extent or you can supply a raster or vector file as the extent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; $ gdalwarp -te &lt;x_min&gt; &lt;y_min&gt; &lt;x_max&gt; &lt;y_max&gt; input.bil clipped_output.bil
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Merging Rasters using GDAL</strong></p>
<p>If you have large DEMs you can merge them very quickly using GDAL</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; $ gdal_merge.py -o out.tif in1.tif in2.tif


#The -o flag indicates the outfile.
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Changing Raster Projections with Gdalwarp</strong></p>
<p>We can change the underlying projections of rasters using the gdalwarp command.  The gdalwarp command detects the projection of the raster that is to be projected so we do not have enter this value.   The ‘-t_srs’ flag is used to assign the target coordinate system, which must be placed in quotes.  An example of the basic command is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; $ gdalwarp -t_srs &#39;+proj=utm +zone=44 +datum=WGS84&#39; projected.tif reprojected.tif
</pre></div>
</div>
<p>See this link for more info: <a class="reference external" href="https://www.geos.ed.ac.uk/~smudd/TopoTutorials/html/tutorial_raster_conversion.html#converting-between-formats-using-gdal">https://www.geos.ed.ac.uk/~smudd/TopoTutorials/html/tutorial_raster_conversion.html#converting-between-formats-using-gdal</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Compute Slope</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; $ gdaldem slope inputDem.tif  output_slope.tif
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Make a Colored Relief Map</strong></p>
<p>First, run gdalinfo and get the minimum and maximum elevation of the DEM.  Next, use these values to make some elevation breaks and some corresponding RGB colors for each break. In the example below, the first number in each row represents the upper breakpoint for the color range while the next three values are RGB values.  In the example, echo takes everything between the quotations and places it into a file called color-relief.txt usng the &gt; operator:</p>
<div class="line-block">
<div class="line">echo ‘0 0 0 0</div>
<div class="line">26 110 220 110</div>
<div class="line">51 240 250 160</div>
<div class="line">76 230 220 170</div>
<div class="line">101 220 220 220</div>
<div class="line">127 250 250 250’ &gt; color-relief.txt</div>
</div>
<p>Once the color map file is completed, we can use it generate a colored relief, as shown in the example below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gdaldem</span> <span class="n">color</span><span class="o">-</span><span class="n">relief</span> <span class="o">-</span><span class="n">of</span> <span class="n">PNG</span> <span class="n">sf</span><span class="o">-</span><span class="n">dem</span><span class="o">.</span><span class="n">tif</span> <span class="n">color</span><span class="o">-</span><span class="n">relief</span><span class="o">.</span><span class="n">txt</span> <span class="n">sf</span><span class="o">-</span><span class="n">dem</span><span class="o">-</span><span class="n">coloredRelief</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>For more information on how to work with GDAL cmmand line utilities, see this website - <a class="reference external" href="https://gdal.org/programs/gdaldem.html">https://gdal.org/programs/gdaldem.html</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Computing Viewsheds</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gdal_viewshed</span> <span class="o">-</span><span class="n">md</span> <span class="mi">500</span> <span class="o">-</span><span class="n">ox</span> <span class="o">-</span><span class="mi">10147017</span> <span class="o">-</span><span class="n">oy</span> <span class="mi">5108065</span> <span class="n">source</span><span class="o">.</span><span class="n">tif</span> <span class="n">destination</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><dl class="simple">
<dt>md</dt><dd><p>Maximum distance from observer to compute visibiliy. It is also used to clamp the extent of the output raster.\</p>
</dd>
</dl>
</li>
</ul>
<dl class="simple">
<dt>-ox &lt;value&gt;</dt><dd><p>The X position of the observer (in SRS units).</p>
</dd>
<dt>-oy &lt;value&gt;</dt><dd><p>The Y position of the observer (in SRS units).</p>
</dd>
</dl>
<p>For more information, see <a class="reference external" href="https://man.archlinux.org/man/community/gdal/gdal_viewshed.1.en">https://man.archlinux.org/man/community/gdal/gdal_viewshed.1.en</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="running-gdal-commands-from-python">
<h2><span class="section-number">10.9. </span>Running GDAL Commands from Python<a class="headerlink" href="#running-gdal-commands-from-python" title="Permalink to this heading"></a></h2>
<p>It is possible to call GDAL commands from Python and other scripting languages. This allows for easy iteration through geoprocessing tasks, or integration of geoprocessing steps into complex scripted workflows.  For more information, please visit this page: <a class="reference external" href="https://gdal.org/tutorials/raster_api_tut.html">https://gdal.org/tutorials/raster_api_tut.html</a>. Below are some code samples for using GDAL from within Python.</p>
<p><strong>Open a Raster with GDAL</strong></p>
<p>We have already seen this structure in previous Python scripts that used the gdal library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="n">fn</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot; /Users/student/Desktop/Stowe_Dataset/elevation&quot;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="c1"># 0 (default) read-only, 1 update</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Get Raster Properties</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fn_dem</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;..\data\input\USGS_one_meter_x64y486_ID_FEMAHQ_2018.tif&quot;</span>
<span class="n">fn_img</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;..\data\input\m_4311515_ne_11_1_20150908_20160104.jp2&quot;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">fn_dem</span><span class="p">)</span> <span class="c1"># 2 arguments: (file name, access type: 0 (default) read-only, 1 update)</span>

<span class="n">nrows</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">RasterYSize</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">RasterXSize</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>  <span class="c1"># returns WKT definition</span>
<span class="n">nbands</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">RasterCount</span>
<span class="n">geot</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="batch-processing-using-gdal">
<h2><span class="section-number">10.10. </span>Batch Processing Using GDAL<a class="headerlink" href="#batch-processing-using-gdal" title="Permalink to this heading"></a></h2>
<p>There are many code samples for processing a single file using GDAL.  However, code samples for batch processing are not frequently encountered.  Below is an example for converting multiple .rst files into .tif files</p>
<p>Recall that for one raster file conversion we would use this:
gdal_translate -of GTiff 01_State19900101.rst 01_State19900101.tif</p>
<p>Now we’re going to make a batch file which includes a loop to convert all files in the folder.</p>
<p>Open a text editor, e.g. Notepad, and add the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">%%</span><span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="o">*.</span><span class="n">rst</span><span class="p">)</span> <span class="n">do</span> <span class="p">(</span>
   <span class="n">echo</span> <span class="o">%%~</span><span class="n">nf</span>
   <span class="n">gdal_translate</span> <span class="o">-</span><span class="n">of</span> <span class="n">GTiff</span> <span class="o">%%</span><span class="n">f</span> <span class="o">%%~</span><span class="n">nf</span><span class="o">.</span><span class="n">tif</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Save the batchfile as rst2tif.bat in the folder with the land-use rasters.</p>
<p>In the code above,  %%f is the variable that contains the filename of each file. With echo we can print something to the screen. Here we print %%~nf , which is the part of the filename before the dot that separates it from the extension. Then we use the gdal_translate command with output format GeoTiff. At the end of the line we add the .tif extension to the filename.</p>
<p>5. Execute the batchfile. Type
rst2tif &lt;ENTER&gt;</p>
<ol class="arabic simple" start="6">
<li><p>Check the results</p></li>
</ol>
<p><a class="reference external" href="https://courses.gisopencourseware.org/mod/book/view.php?id=78&amp;chapterid=193">https://courses.gisopencourseware.org/mod/book/view.php?id=78&amp;chapterid=193</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="automating-workflows">
<h2><span class="section-number">10.11. </span>Automating Workflows<a class="headerlink" href="#automating-workflows" title="Permalink to this heading"></a></h2>
<p>You have been manually drawing a polygon around an XY event layer of the locations each time they are updated, but the process takes a lot of time and is not entirely accurate.   In the script below,  we take a table of customer locations and create an outer polygon boundary of those locations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">arcpy</span><span class="o">,</span> <span class="nn">csv</span>
<span class="n">xyData</span> <span class="o">=</span> <span class="s1">&#39;r:C:\mydata.csv&#39;</span>
<span class="n">outConvexHull</span> <span class="o">=</span> <span class="s1">&#39;C:\Boundary.shp&#39;</span>

<span class="n">xyLocations</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">csvFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">xyData</span><span class="p">)</span>
<span class="n">csvReader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvFile</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="n">csvReader</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="p">(</span><span class="n">csvReader</span><span class="p">):</span>
    <span class="n">xyLocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>


<span class="n">customerPoints</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Multipoint</span><span class="p">(</span><span class="n">arcpy</span><span class="o">.</span><span class="n">Array</span><span class="p">([</span><span class="n">arcpy</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)</span> <span class="k">for</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">xyLocations</span><span class="p">])))</span>

<span class="n">convexHull</span> <span class="o">=</span> <span class="n">customerPoints</span><span class="o">.</span><span class="n">convexHull</span><span class="p">()</span>
<span class="n">arcpy</span><span class="o">.</span><span class="n">CopyFeatures_management</span><span class="p">(</span><span class="n">convexHull</span><span class="p">,</span> <span class="n">outConvedHull</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exercises">
<h2><span class="section-number">10.12. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Write a script that prompts the user for the path to an input DEM and an input satellite imagery.  Afterwards, the script should generate a hillshade of the area. Finally, the script should drape the satellite imagery over the hillshade. You can download <a class="reference external" href="https://www.dropbox.com/s/r61wulyhlctvdcf/Washington_Data.zip?dl=0">sample data here</a></p></li>
<li><p>Instead of generating a hillshade, write a second script to generate a 3D model of the area. Afterward, let the script drape a satellite imagery over the 3D model of the area.</p></li>
</ol>
<p><strong>Resources</strong></p>
<p>Please visit the link below for a sample script. Note: This is just one way of approaching this task.</p>
<p><a class="reference external" href="https://subscription.packtpub.com/book/big-data-and-business-intelligence/9781783555079/10/ch10lvl1sec73/draping-an-orthophoto-over-a-dem">https://subscription.packtpub.com/book/big-data-and-business-intelligence/9781783555079/10/ch10lvl1sec73/draping-an-orthophoto-over-a-dem</a></p>
<p>Batch processing – automatizing the use of GDAL and SAGA GIS tools using Bash Shell scripts
<a class="reference external" href="https://www.luisalucchese.com/post/batch-processing-gdal-saga-gis-bash/">https://www.luisalucchese.com/post/batch-processing-gdal-saga-gis-bash/</a></p>
<p>Working with Rasterio
<a class="reference external" href="https://geobgu.xyz/py/rasterio.html">https://geobgu.xyz/py/rasterio.html</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="attribute_and_spatial_queries.html" class="btn btn-neutral float-left" title="9. Attribute and Spatial Queries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Hugh Semple.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>